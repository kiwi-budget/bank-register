sudo: required
language: java
jdk:
  - oraclejdk8
services:
  - docker
  
env:
  global:
    - DOCKER_IMAGE_NAME=kiwibudget/bank-registry:v1

before_install:
  - curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get > get_helm.sh
  - chmod 700 get_helm.sh
  - sudo ./get_helm.sh
    

jobs:
  include:
    - stage: build
      script:
      - helm lint ./bank-register
      if: branch = master AND type IN (push)
      after_success:
      - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
      - docker build -t ${DOCKER_IMAGE_NAME} .
      - docker push ${DOCKER_IMAGE_NAME}

notifications:
  email: false